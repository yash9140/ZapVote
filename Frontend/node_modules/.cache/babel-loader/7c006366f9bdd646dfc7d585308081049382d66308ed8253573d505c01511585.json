{"ast":null,"code":"import React,{useEffect,useState,useRef}from'react';import{useParams}from'react-router-dom';import{io}from'socket.io-client';import axios from'axios';import ResultsChart from'./ResultsChart';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const apiUrl=process.env.REACT_APP_API_URL||'http://localhost:4000';const socket=io(apiUrl,{reconnection:true,reconnectionAttempts:5,reconnectionDelay:1000});export default function PollSession(){const{code}=useParams();const[poll,setPoll]=useState(null);const[results,setResults]=useState(null);const[voted,setVoted]=useState(false);const[error,setError]=useState('');const[startTime,setStartTime]=useState(null);const[timer,setTimer]=useState('00:00:00');const timerRef=useRef();const username=localStorage.getItem('username')||'anonymous';useEffect(()=>{// Fetch session info\naxios.get(\"\".concat(apiUrl,\"/api/session/\").concat(code)).then(res=>{setPoll(res.data.poll);setStartTime(new Date(res.data.startedAt));}).catch(()=>setError('Session not found'));socket.on('connect',()=>{console.log('Connected to WebSocket server');socket.emit('joinSession',{code,user:username});});socket.on('connect_error',err=>{console.error('WebSocket connection error:',err);setError('Failed to connect to server. Please try again.');});socket.on('sessionJoined',_ref=>{let{poll}=_ref;return setPoll(poll);});socket.on('updateResults',setResults);socket.on('error',err=>setError(err));return()=>{socket.off('connect');socket.off('connect_error');socket.off('sessionJoined');socket.off('updateResults');socket.off('error');};},[code,username]);useEffect(()=>{if(!startTime)return;timerRef.current=setInterval(()=>{const now=new Date();const diff=Math.floor((now-new Date(startTime))/1000);const h=String(Math.floor(diff/3600)).padStart(2,'0');const m=String(Math.floor(diff%3600/60)).padStart(2,'0');const s=String(diff%60).padStart(2,'0');setTimer(\"\".concat(h,\":\").concat(m,\":\").concat(s));},1000);return()=>clearInterval(timerRef.current);},[startTime]);const handleVote=option=>{socket.emit('submitVote',{code,user:username,option});setVoted(true);};if(error)return/*#__PURE__*/_jsx(\"div\",{style:{color:'red'},children:error});if(!poll)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading poll...\"});return/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:600,margin:'40px auto'},children:[/*#__PURE__*/_jsx(\"h2\",{children:poll.question}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Session Code: \",code]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"Timer: \",timer]}),!voted?/*#__PURE__*/_jsx(\"div\",{children:poll.options.map(opt=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleVote(opt),children:opt},opt))}):/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"h4\",{children:\"Thank you for voting!\"})}),/*#__PURE__*/_jsx(ResultsChart,{options:poll.options,results:results})]});}","map":{"version":3,"names":["React","useEffect","useState","useRef","useParams","io","axios","ResultsChart","jsx","_jsx","jsxs","_jsxs","apiUrl","process","env","REACT_APP_API_URL","socket","reconnection","reconnectionAttempts","reconnectionDelay","PollSession","code","poll","setPoll","results","setResults","voted","setVoted","error","setError","startTime","setStartTime","timer","setTimer","timerRef","username","localStorage","getItem","get","concat","then","res","data","Date","startedAt","catch","on","console","log","emit","user","err","_ref","off","current","setInterval","now","diff","Math","floor","h","String","padStart","m","s","clearInterval","handleVote","option","style","color","children","maxWidth","margin","question","options","map","opt","onClick"],"sources":["C:/Users/Lenovo/Documents/Interaction/Frontend/src/components/PollSession.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { io } from 'socket.io-client';\r\nimport axios from 'axios';\r\nimport ResultsChart from './ResultsChart';\r\n\r\nconst apiUrl = process.env.REACT_APP_API_URL || 'http://localhost:4000';\r\nconst socket = io(apiUrl, {\r\n  reconnection: true,\r\n  reconnectionAttempts: 5,\r\n  reconnectionDelay: 1000\r\n});\r\n\r\nexport default function PollSession() {\r\n  const { code } = useParams();\r\n  const [poll, setPoll] = useState(null);\r\n  const [results, setResults] = useState(null);\r\n  const [voted, setVoted] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [startTime, setStartTime] = useState(null);\r\n  const [timer, setTimer] = useState('00:00:00');\r\n  const timerRef = useRef();\r\n  const username = localStorage.getItem('username') || 'anonymous';\r\n\r\n  useEffect(() => {\r\n    // Fetch session info\r\n    axios.get(`${apiUrl}/api/session/${code}`)\r\n      .then(res => {\r\n        setPoll(res.data.poll);\r\n        setStartTime(new Date(res.data.startedAt));\r\n      })\r\n      .catch(() => setError('Session not found'));\r\n\r\n    socket.on('connect', () => {\r\n      console.log('Connected to WebSocket server');\r\n      socket.emit('joinSession', { code, user: username });\r\n    });\r\n\r\n    socket.on('connect_error', (err) => {\r\n      console.error('WebSocket connection error:', err);\r\n      setError('Failed to connect to server. Please try again.');\r\n    });\r\n\r\n    socket.on('sessionJoined', ({ poll }) => setPoll(poll));\r\n    socket.on('updateResults', setResults);\r\n    socket.on('error', (err) => setError(err));\r\n\r\n    return () => {\r\n      socket.off('connect');\r\n      socket.off('connect_error');\r\n      socket.off('sessionJoined');\r\n      socket.off('updateResults');\r\n      socket.off('error');\r\n    };\r\n  }, [code, username]);\r\n\r\n  useEffect(() => {\r\n    if (!startTime) return;\r\n    timerRef.current = setInterval(() => {\r\n      const now = new Date();\r\n      const diff = Math.floor((now - new Date(startTime)) / 1000);\r\n      const h = String(Math.floor(diff / 3600)).padStart(2, '0');\r\n      const m = String(Math.floor((diff % 3600) / 60)).padStart(2, '0');\r\n      const s = String(diff % 60).padStart(2, '0');\r\n      setTimer(`${h}:${m}:${s}`);\r\n    }, 1000);\r\n    return () => clearInterval(timerRef.current);\r\n  }, [startTime]);\r\n\r\n  const handleVote = (option) => {\r\n    socket.emit('submitVote', { code, user: username, option });\r\n    setVoted(true);\r\n  };\r\n\r\n  if (error) return <div style={{ color: 'red' }}>{error}</div>;\r\n  if (!poll) return <div>Loading poll...</div>;\r\n\r\n  return (\r\n    <div style={{ maxWidth: 600, margin: '40px auto' }}>\r\n      <h2>{poll.question}</h2>\r\n      <div>Session Code: {code}</div>\r\n      <div>Timer: {timer}</div>\r\n      {!voted ? (\r\n        <div>\r\n          {poll.options.map(opt => (\r\n            <button key={opt} onClick={() => handleVote(opt)}>{opt}</button>\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <div>\r\n          <h4>Thank you for voting!</h4>\r\n        </div>\r\n      )}\r\n      <ResultsChart options={poll.options} results={results} />\r\n    </div>\r\n  );\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}